# ğŸ” ä¼ä¸šçº§æ—¥å¿—ç³»ç»Ÿ

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°çš„æ—¥å¿—åŠŸèƒ½
- **ç»“æ„åŒ–æ—¥å¿—è®°å½•** - åŸºäºGo 1.21+ `log/slog` åŒ…
- **è‡ªåŠ¨æ—¥å¿—è½®è½¬** - æŒ‰æ—¥æœŸå’Œæ–‡ä»¶å¤§å°è‡ªåŠ¨åˆ†å‰²
- **å¤šçº§åˆ«æ—¥å¿—** - DEBUGã€INFOã€WARNã€ERRORã€FATAL
- **JSONæ ¼å¼è¾“å‡º** - ä¾¿äºæ—¥å¿—åˆ†æå’Œç›‘æ§ç³»ç»Ÿé›†æˆ
- **æ€§èƒ½æŒ‡æ ‡è®°å½•** - è‡ªåŠ¨è®°å½•å¤„ç†æ—¶é—´å’Œååé‡
- **æ•æ„Ÿä¿¡æ¯è„±æ•** - è‡ªåŠ¨å¤„ç†æ–‡ä»¶è·¯å¾„ç­‰æ•æ„Ÿä¿¡æ¯
- **è‡ªåŠ¨æ¸…ç†** - é…ç½®ä¿ç•™å¤©æ•°ï¼Œè‡ªåŠ¨æ¸…ç†æ—§æ—¥å¿—

## é…ç½®é€‰é¡¹

é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®æ—¥å¿—ç³»ç»Ÿï¼š

```bash
LOG_LEVEL=INFO           # æ—¥å¿—çº§åˆ«ï¼šDEBUG, INFO, WARN, ERROR
LOG_DIR=./logs          # æ—¥å¿—æ–‡ä»¶ç›®å½•
LOG_MAX_SIZE=104857600  # å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å° (100MB)
LOG_JSON=true           # true: JSONæ ¼å¼, false: æ–‡æœ¬æ ¼å¼
LOG_KEEP_DAYS=30        # ä¿ç•™æ—¥å¿—æ–‡ä»¶å¤©æ•°
```

## æ—¥å¿—æ–‡ä»¶ç»“æ„

```
logs/
â”œâ”€â”€ tgbot-2025-09-25.log      # å½“å¤©æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ tgbot-2025-09-24.log      # å†å²æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ tgbot-2025-09-23-1.log    # å¤§æ–‡ä»¶åˆ†å‰²åçš„ç¼–å·æ–‡ä»¶
â””â”€â”€ tgbot-2025-09-23-2.log
```

## æ—¥å¿—å†…å®¹ç¤ºä¾‹

### ç³»ç»Ÿå¯åŠ¨æ—¥å¿—
```json
{
  "time": "2025-09-25T16:06:11+08:00",
  "level": "INFO",
  "source": {"function": "main.main", "file": "main.go", "line": 37},
  "msg": "Telegram Botå¯åŠ¨",
  "version": "1.0.0",
  "log_level": "INFO",
  "log_dir": "./logs",
  "temp_dir": "/tmp/tgbot"
}
```

### ç”¨æˆ·è¯·æ±‚æ—¥å¿—
```json
{
  "time": "2025-09-25T16:06:25+08:00",
  "level": "INFO",
  "msg": "ç”¨æˆ·è¯·æ±‚",
  "user_id": 12345,
  "chat_id": 12345,
  "command": "/redisdel",
  "message": "å‘½ä»¤å‚æ•°: ",
  "timestamp": "2025-09-25T16:06:25+08:00"
}
```

### æ€§èƒ½æŒ‡æ ‡æ—¥å¿—
```json
{
  "time": "2025-09-25T16:08:30+08:00",
  "level": "INFO",
  "msg": "æ€§èƒ½æŒ‡æ ‡",
  "operation": "redis_delete_pipeline",
  "duration": "2.547s",
  "item_count": 1000,
  "user_id": 12345,
  "items_per_second": 392.64
}
```

### é”™è¯¯æ—¥å¿—
```json
{
  "time": "2025-09-25T16:10:15+08:00",
  "level": "ERROR",
  "msg": "æ“ä½œé”™è¯¯",
  "user_id": 12345,
  "operation": "file_upload",
  "error": "æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ",
  "file_path": ".../user_12345/input.txt"
}
```

## æ—¥å¿—è®°å½•è¦†ç›–

### ğŸŸ¢ å·²é›†æˆæ—¥å¿—è®°å½•çš„æ¨¡å—
- **ç³»ç»Ÿå¯åŠ¨/å…³é—­** - Botç”Ÿå‘½å‘¨æœŸäº‹ä»¶
- **ç”¨æˆ·äº¤äº’** - æ¶ˆæ¯æ¥æ”¶ã€å‘½ä»¤å¤„ç†ã€å›è°ƒæŸ¥è¯¢
- **æ–‡ä»¶æ“ä½œ** - ä¸Šä¼ ã€ä¸‹è½½ã€åˆ›å»ºã€æ¸…ç†
- **Redisåˆ é™¤æµç¨‹** - å®Œæ•´çš„5æ­¥éª¤å¤„ç†æµç¨‹
- **é”™è¯¯å¤„ç†** - å¼‚å¸¸æ•è·å’Œè¯¦ç»†é”™è¯¯ä¿¡æ¯
- **æ€§èƒ½ç›‘æ§** - å¤„ç†æ—¶é—´ã€ååé‡ç»Ÿè®¡

### ğŸ”„ æ—¥å¿—è½®è½¬æœºåˆ¶
- æŒ‰æ—¥æœŸè‡ªåŠ¨åˆ›å»ºæ–°æ—¥å¿—æ–‡ä»¶
- å•æ–‡ä»¶è¶…è¿‡100MBè‡ªåŠ¨åˆ†å‰²
- è‡ªåŠ¨æ¸…ç†è¶…è¿‡ä¿ç•™å¤©æ•°çš„æ—§æ—¥å¿—
- ä¼˜é›…å¤„ç†ç£ç›˜ç©ºé—´ä¸è¶³ç­‰å¼‚å¸¸æƒ…å†µ

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§
- æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨è„±æ•ï¼ˆæ–‡ä»¶è·¯å¾„ã€ç”¨æˆ·ä¿¡æ¯ï¼‰
- æ”¯æŒç”Ÿäº§ç¯å¢ƒçš„å®‰å…¨é…ç½®
- æ—¥å¿—æ–‡ä»¶æƒé™æ§åˆ¶
- é˜²æ­¢æ—¥å¿—æ³¨å…¥æ”»å‡»

## ä½¿ç”¨åœºæ™¯

1. **é—®é¢˜æ’æŸ¥** - è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œè°ƒç”¨æ ˆ
2. **æ€§èƒ½ç›‘æ§** - å¤„ç†æ—¶é—´å’Œååé‡åˆ†æ
3. **ç”¨æˆ·è¡Œä¸ºåˆ†æ** - å‘½ä»¤ä½¿ç”¨ç»Ÿè®¡å’Œç”¨æˆ·æ´»è·ƒåº¦
4. **ç³»ç»Ÿç›‘æ§** - èµ„æºä½¿ç”¨æƒ…å†µå’Œå¥åº·çŠ¶æ€
5. **å®¡è®¡åˆè§„** - å®Œæ•´çš„æ“ä½œè®°å½•å’Œç”¨æˆ·è½¨è¿¹

## é›†æˆå»ºè®®

### ELK Stacké›†æˆ
```bash
# Logstashé…ç½®ç¤ºä¾‹
input {
  file {
    path => "/app/logs/tgbot-*.log"
    type => "tgbot"
    codec => "json"
  }
}
```

### ç›‘æ§å‘Šè­¦
```yaml
# Prometheuså‘Šè­¦è§„åˆ™ç¤ºä¾‹
- alert: TGBotHighErrorRate
  expr: rate(tgbot_errors_total[5m]) > 0.1
  for: 2m
  labels:
    severity: warning
  annotations:
    summary: "TGBot error rate is high"
```

é€šè¿‡è¿™å¥—ä¼ä¸šçº§æ—¥å¿—ç³»ç»Ÿï¼Œæ‚¨å¯ä»¥å…¨é¢ç›‘æ§Botçš„è¿è¡ŒçŠ¶æ€ï¼Œå¿«é€Ÿå®šä½é—®é¢˜ï¼Œå¹¶è·å¾—è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡ï¼